// ✅ Replace with your actual RapidAPI Key
const apiKey = "a34Acd6cb5msh33789bb5ade5caap1567b5jsn15a169906934";

// ✅ Use a reliable CORS proxy (works on GitHub Pages)
const proxyUrl = "https://api.allorigins.win/raw?url=";

// ✅ Default stock list
const defaultStocks = ["RELIANCE.NS", "TCS.NS", "HDFCBANK.NS", "INFY.NS", "ICICIBANK.NS"];

// Fetch stock data
async function fetchStockData(symbols) {
  const container = document.getElementById("stock-container");
  container.innerHTML = "<p>Loading data...</p>";

  try {
    const promises = symbols.map(async (symbol) => {
      const url = `${proxyUrl}https://yahoo-finance15.p.rapidapi.com/api/yahoo/qu/quote/${symbol}/financial-data`;
      const res = await fetch(url, {
        method: "GET",
        headers: {
          "x-rapidapi-host": "yahoo-finance15.p.rapidapi.com",
          "x-rapidapi-key": apiKey
        }
      });

      const data = await res.json();
      const name = symbol.replace(".NS", "");
      const price = data?.financialData?.currentPrice?.fmt || "N/A";
      const target = data?.financialData?.targetMeanPrice?.fmt || "N/A";
      const recommendation = data?.financialData?.recommendationKey || "N/A";

      return `
        <div class="stock-card">
          <h3>${name}</h3>
          <p><strong>Price:</strong> ₹${price}</p>
          <p><strong>Target:</strong> ₹${target}</p>
          <p><strong>Recommendation:</strong> ${recommendation.toUpperCase()}</p>
        </div>
      `;
    });

    const results = await Promise.all(promises);
    container.innerHTML = results.join("");
  } catch (error) {
    console.error("Error loading stock data:", error);
    container.innerHTML = `<p style="color:red;">⚠️ Unable to load stock data. Please check your internet connection or API key.</p>`;
  }
}

// ✅ Search button click
document.addEventListener("DOMContentLoaded", () => {
  const searchBtn = document.getElementById("search-btn");
  const stockInput = document.getElementById("stock-input");

  searchBtn.addEventListener("click", () => {
    const input = stockInput.value.trim().toUpperCase();
    if (!input) {
      alert("Please enter a stock symbol (e.g., RELIANCE or INFY)");
      return;
    }

    const symbol = input.endsWith(".NS") ? input : `${input}.NS`;
    fetchStockData([symbol]);
  });

  // Press Enter to search
  stockInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") searchBtn.click();
  });

  // Load default stocks on page load
  fetchStockData(defaultStocks);
});
